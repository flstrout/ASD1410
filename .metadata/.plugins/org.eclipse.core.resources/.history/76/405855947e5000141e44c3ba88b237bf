var display = require("action");

// Wrap the whole
var netCheck = function(){
	var url = "http://api.reddit.com/r/startrek";
	
	var loadData = function (e){
		var thisData = JSON.parse(this.responseText);
		// console.log(thisData);
		var posts = thisData.data.children;
		var postArray = [];
		
		// console.log(postArray);
		display.displayData(postArray);
	};
	
	var errorData = function (e){
		alert("Error: " + e.error);
	};
	
	if (Ti.Network.online){
		for(i=0, j=posts.length; i<j; i++){
			var post = {
				title: posts[i].data.title,
				picture: posts[i].data.thumbnail
			};
			postArray.push(post);
		};
		var remoteData = Ti.Network.createHTTPClient({
			onload: loadData,
			onerror: errorData
		});
		remoteData.open("GET", url);
		remoteData.send();
	}else{
		alert("Network not available. Check your settings.");
	};
};

exports.netCheck = netCheck;